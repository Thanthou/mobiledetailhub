Database Schema Export
Database: MobileDetailHub
Exported: 2025-08-28T00:57:52.548Z
Total Tables: 24

=== TABLE: addresses ===
Type: BASE TABLE
Row Count: 0

Columns:
  - id: integer NOT NULL
  - line1: character varying(255) NULL
  - city_id: integer NULL
  - city: character varying(100) NULL // DEPRECATED: Use city_id for normalized city reference. This field will be dropped in a future schema version.
  - state_code: character(2) NOT NULL
  - postal_code: character varying(20) NULL
  - lat: double precision NULL
  - lng: double precision NULL
  - created_at: timestamp with time zone NOT NULL DEFAULT now()
  - updated_at: timestamp with time zone NOT NULL DEFAULT now()

Constraints:
  - 2200_46972_10_not_null: CHECK
  - 2200_46972_1_not_null: CHECK
  - 2200_46972_5_not_null: CHECK
  - 2200_46972_9_not_null: CHECK
  - addresses_city_id_fkey: FOREIGN KEY on city_id -> cities.id
  - addresses_pkey: PRIMARY KEY on id -> addresses.id
  - addresses_state_code_fkey: FOREIGN KEY on state_code -> states.state_code

Indexes:
  - addresses_pkey: id (UNIQUE) (PRIMARY)
  - idx_addresses_location: city
  - idx_addresses_location: state_code
  - idx_addresses_location: postal_code
  - uq_addresses_normalized: city_id (UNIQUE)
  - uq_addresses_normalized: postal_code (UNIQUE)


=== TABLE: affiliate_service_areas ===
Type: BASE TABLE
Row Count: 0

Columns:
  - id: integer NOT NULL
  - affiliate_id: integer NOT NULL
  - city_id: integer NOT NULL
  - zip: character varying(20) NULL
  - created_at: timestamp with time zone NULL DEFAULT now()
  - updated_at: timestamp with time zone NULL DEFAULT now()

Constraints:
  - 2200_47181_1_not_null: CHECK
  - 2200_47181_2_not_null: CHECK
  - 2200_47181_3_not_null: CHECK
  - affiliate_service_areas_affiliate_id_fkey: FOREIGN KEY on affiliate_id -> affiliates.id
  - affiliate_service_areas_city_id_fkey: FOREIGN KEY on city_id -> cities.id
  - affiliate_service_areas_pkey: PRIMARY KEY on id -> affiliate_service_areas.id

Indexes:
  - affiliate_service_areas_pkey: id (UNIQUE) (PRIMARY)
  - idx_aff_sa_affiliate: affiliate_id
  - idx_aff_sa_city_id: city_id
  - uq_aff_sa_no_zip: affiliate_id (UNIQUE)
  - uq_aff_sa_no_zip: city_id (UNIQUE)
  - uq_aff_sa_with_zip: affiliate_id (UNIQUE)
  - uq_aff_sa_with_zip: city_id (UNIQUE)
  - uq_aff_sa_with_zip: zip (UNIQUE)


=== TABLE: affiliate_users ===
Type: BASE TABLE
Row Count: 0

Columns:
  - id: integer NOT NULL
  - affiliate_id: integer NOT NULL
  - user_id: integer NOT NULL
  - role: USER-DEFINED NOT NULL
  - created_at: timestamp with time zone NOT NULL DEFAULT now()
  - updated_at: timestamp with time zone NOT NULL DEFAULT now()

Constraints:
  - 2200_47024_1_not_null: CHECK
  - 2200_47024_2_not_null: CHECK
  - 2200_47024_3_not_null: CHECK
  - 2200_47024_4_not_null: CHECK
  - 2200_47024_5_not_null: CHECK
  - 2200_47024_6_not_null: CHECK
  - affiliate_users_affiliate_id_fkey: FOREIGN KEY on affiliate_id -> affiliates.id
  - affiliate_users_pkey: PRIMARY KEY on id -> affiliate_users.id
  - affiliate_users_user_id_fkey: FOREIGN KEY on user_id -> users.id
  - uq_affiliate_users: UNIQUE on affiliate_id -> affiliate_users.user_id
  - uq_affiliate_users: UNIQUE on user_id -> affiliate_users.user_id
  - uq_affiliate_users: UNIQUE on affiliate_id -> affiliate_users.affiliate_id
  - uq_affiliate_users: UNIQUE on user_id -> affiliate_users.affiliate_id

Indexes:
  - affiliate_users_pkey: id (UNIQUE) (PRIMARY)
  - idx_affiliate_users_user_id: user_id
  - uq_affiliate_users: affiliate_id (UNIQUE)
  - uq_affiliate_users: user_id (UNIQUE)


=== TABLE: affiliates ===
Type: BASE TABLE
Row Count: 1

Columns:
  - id: integer NOT NULL
  - slug: character varying(100) NOT NULL
  - business_name: character varying(255) NOT NULL
  - owner: character varying(255) NOT NULL
  - phone: character varying(20) NOT NULL
  - sms_phone: character varying(20) NULL
  - email: USER-DEFINED NOT NULL
  - base_address_id: integer NULL
  - website_url: character varying(500) NULL
  - gbp_url: character varying(500) NULL
  - facebook_url: character varying(500) NULL
  - instagram_url: character varying(500) NULL
  - youtube_url: character varying(500) NULL
  - tiktok_url: character varying(500) NULL
  - application_status: USER-DEFINED NOT NULL DEFAULT 'pending'::affiliate_status
  - has_insurance: boolean NULL DEFAULT false
  - source: character varying(100) NULL
  - notes: text NULL
  - uploads: ARRAY NULL
  - business_license: character varying(100) NULL
  - insurance_provider: character varying(255) NULL
  - insurance_expiry: date NULL
  - service_radius_miles: integer NULL DEFAULT 25
  - operating_hours: jsonb NULL
  - emergency_contact: jsonb NULL
  - total_jobs: integer NULL DEFAULT 0
  - rating: numeric NULL
  - review_count: integer NULL DEFAULT 0
  - is_brand: boolean NOT NULL DEFAULT false
  - created_at: timestamp with time zone NOT NULL DEFAULT now()
  - updated_at: timestamp with time zone NOT NULL DEFAULT now()
  - application_date: timestamp with time zone NOT NULL DEFAULT now()
  - approved_date: timestamp with time zone NULL
  - last_activity: timestamp with time zone NOT NULL DEFAULT now()

Constraints:
  - 2200_46993_15_not_null: CHECK
  - 2200_46993_1_not_null: CHECK
  - 2200_46993_29_not_null: CHECK
  - 2200_46993_2_not_null: CHECK
  - 2200_46993_30_not_null: CHECK
  - 2200_46993_31_not_null: CHECK
  - 2200_46993_32_not_null: CHECK
  - 2200_46993_34_not_null: CHECK
  - 2200_46993_3_not_null: CHECK
  - 2200_46993_4_not_null: CHECK
  - 2200_46993_5_not_null: CHECK
  - 2200_46993_7_not_null: CHECK
  - affiliates_base_address_id_fkey: FOREIGN KEY on base_address_id -> addresses.id
  - affiliates_phone_check: CHECK -> affiliates.phone
  - affiliates_pkey: PRIMARY KEY on id -> affiliates.id
  - affiliates_rating_check: CHECK -> affiliates.rating
  - affiliates_review_count_check: CHECK -> affiliates.review_count
  - affiliates_slug_check: CHECK -> affiliates.slug
  - affiliates_slug_key: UNIQUE on slug -> affiliates.slug

Indexes:
  - affiliates_pkey: id (UNIQUE) (PRIMARY)
  - affiliates_slug_key: slug (UNIQUE)
  - uq_affiliates_brand_one: is_brand (UNIQUE)

Sample Data (1 rows):
  Row 1: {"id":1,"slug":"mdh","business_name":"Mobile Detail Hub","owner":"Mobile Detail Hub","phone":"(888) 555-1234","sms_phone":null,"email":"service@mobiledetailhub.com","base_address_id":null,"website_url":null,"gbp_url":null,"facebook_url":null,"instagram_url":null,"youtube_url":null,"tiktok_url":null,"application_status":"approved","has_insurance":false,"source":null,"notes":null,"uploads":null,"business_license":null,"insurance_provider":null,"insurance_expiry":null,"service_radius_miles":25,"operating_hours":null,"emergency_contact":null,"total_jobs":0,"rating":null,"review_count":0,"is_brand":true,"created_at":"2025-08-28T00:21:12.246Z","updated_at":"2025-08-28T00:21:12.246Z","application_date":"2025-08-28T00:21:12.246Z","approved_date":"2025-08-28T00:21:12.246Z","last_activity":"2025-08-28T00:21:12.246Z"}


=== TABLE: availability ===
Type: BASE TABLE
Row Count: 0

Columns:
  - id: integer NOT NULL
  - affiliate_id: integer NOT NULL
  - time_window: tstzrange NOT NULL
  - capacity: integer NOT NULL DEFAULT 1
  - created_at: timestamp with time zone NOT NULL DEFAULT now()
  - updated_at: timestamp with time zone NOT NULL DEFAULT now()

Constraints:
  - 2200_47091_1_not_null: CHECK
  - 2200_47091_2_not_null: CHECK
  - 2200_47091_3_not_null: CHECK
  - 2200_47091_4_not_null: CHECK
  - 2200_47091_5_not_null: CHECK
  - 2200_47091_6_not_null: CHECK
  - availability_affiliate_id_fkey: FOREIGN KEY on affiliate_id -> affiliates.id
  - availability_capacity_check: CHECK -> availability.capacity
  - availability_pkey: PRIMARY KEY on id -> availability.id

Indexes:
  - availability_affiliate_id_time_window_excl: affiliate_id
  - availability_affiliate_id_time_window_excl: time_window
  - availability_pkey: id (UNIQUE) (PRIMARY)
  - idx_availability_window: time_window


=== TABLE: bookings ===
Type: BASE TABLE
Row Count: 0

Columns:
  - id: integer NOT NULL
  - affiliate_id: integer NOT NULL
  - customer_id: integer NULL
  - service_id: integer NULL
  - tier_id: integer NULL
  - appointment_start: timestamp with time zone NOT NULL
  - appointment_end: timestamp with time zone NOT NULL
  - address_json: jsonb NOT NULL DEFAULT '{}'::jsonb
  - status: USER-DEFINED NOT NULL DEFAULT 'pending'::booking_status
  - total_cents: integer NOT NULL DEFAULT 0
  - stripe_payment_intent_id: text NULL
  - created_at: timestamp with time zone NOT NULL DEFAULT now()
  - updated_at: timestamp with time zone NOT NULL DEFAULT now()

Constraints:
  - 2200_47137_10_not_null: CHECK
  - 2200_47137_12_not_null: CHECK
  - 2200_47137_13_not_null: CHECK
  - 2200_47137_1_not_null: CHECK
  - 2200_47137_2_not_null: CHECK
  - 2200_47137_6_not_null: CHECK
  - 2200_47137_7_not_null: CHECK
  - 2200_47137_8_not_null: CHECK
  - 2200_47137_9_not_null: CHECK
  - bookings_affiliate_id_fkey: FOREIGN KEY on affiliate_id -> affiliates.id
  - bookings_check: CHECK -> bookings.appointment_end
  - bookings_check: CHECK -> bookings.appointment_start
  - bookings_customer_id_fkey: FOREIGN KEY on customer_id -> customers.id
  - bookings_pkey: PRIMARY KEY on id -> bookings.id
  - bookings_service_id_fkey: FOREIGN KEY on service_id -> services.id
  - bookings_stripe_payment_intent_id_key: UNIQUE on stripe_payment_intent_id -> bookings.stripe_payment_intent_id
  - bookings_tier_id_fkey: FOREIGN KEY on tier_id -> service_tiers.id
  - bookings_total_cents_check: CHECK -> bookings.total_cents

Indexes:
  - bookings_affiliate_id_tstzrange_excl: affiliate_id
  - bookings_pkey: id (UNIQUE) (PRIMARY)
  - bookings_stripe_payment_intent_id_key: stripe_payment_intent_id (UNIQUE)
  - idx_bookings_affiliate_start: affiliate_id
  - idx_bookings_affiliate_start: appointment_start


=== TABLE: cities ===
Type: BASE TABLE
Row Count: 0

Columns:
  - id: bigint NOT NULL
  - name: text NOT NULL
  - city_slug: text NOT NULL
  - state_code: character(2) NOT NULL
  - lat: double precision NULL
  - lng: double precision NULL
  - created_at: timestamp with time zone NOT NULL DEFAULT now()
  - updated_at: timestamp with time zone NOT NULL DEFAULT now()

Constraints:
  - 2200_46920_1_not_null: CHECK
  - 2200_46920_2_not_null: CHECK
  - 2200_46920_3_not_null: CHECK
  - 2200_46920_4_not_null: CHECK
  - 2200_46920_7_not_null: CHECK
  - 2200_46920_8_not_null: CHECK
  - cities_pkey: PRIMARY KEY on id -> cities.id
  - cities_state_code_fkey: FOREIGN KEY on state_code -> states.state_code
  - uq_cities_name_state: UNIQUE on name -> cities.name
  - uq_cities_name_state: UNIQUE on state_code -> cities.name
  - uq_cities_name_state: UNIQUE on name -> cities.state_code
  - uq_cities_name_state: UNIQUE on state_code -> cities.state_code
  - uq_cities_slug_state: UNIQUE on city_slug -> cities.state_code
  - uq_cities_slug_state: UNIQUE on state_code -> cities.state_code
  - uq_cities_slug_state: UNIQUE on city_slug -> cities.city_slug
  - uq_cities_slug_state: UNIQUE on state_code -> cities.city_slug

Indexes:
  - cities_pkey: id (UNIQUE) (PRIMARY)
  - uq_cities_name_state: name (UNIQUE)
  - uq_cities_name_state: state_code (UNIQUE)
  - uq_cities_slug_state: city_slug (UNIQUE)
  - uq_cities_slug_state: state_code (UNIQUE)


=== TABLE: customers ===
Type: BASE TABLE
Row Count: 0

Columns:
  - id: integer NOT NULL
  - user_id: integer NULL
  - name: character varying(255) NOT NULL
  - email: USER-DEFINED NULL
  - phone: character varying(50) NULL
  - address: character varying(255) NULL
  - preferences: jsonb NULL
  - created_at: timestamp with time zone NOT NULL DEFAULT now()
  - updated_at: timestamp with time zone NOT NULL DEFAULT now()

Constraints:
  - 2200_46956_1_not_null: CHECK
  - 2200_46956_3_not_null: CHECK
  - 2200_46956_8_not_null: CHECK
  - 2200_46956_9_not_null: CHECK
  - customers_pkey: PRIMARY KEY on id -> customers.id
  - customers_user_id_fkey: FOREIGN KEY on user_id -> users.id

Indexes:
  - customers_pkey: id (UNIQUE) (PRIMARY)


=== TABLE: location ===
Type: BASE TABLE
Row Count: 0

Columns:
  - location_id: bigint NOT NULL
  - affiliate_id: integer NULL
  - source_platform: USER-DEFINED NOT NULL
  - source_account_id: text NOT NULL
  - source_location_id: text NOT NULL
  - display_name: text NULL
  - timezone: text NULL
  - created_at: timestamp with time zone NOT NULL DEFAULT now()
  - updated_at: timestamp with time zone NOT NULL DEFAULT now()

Constraints:
  - 2200_47222_1_not_null: CHECK
  - 2200_47222_3_not_null: CHECK
  - 2200_47222_4_not_null: CHECK
  - 2200_47222_5_not_null: CHECK
  - 2200_47222_8_not_null: CHECK
  - 2200_47222_9_not_null: CHECK
  - location_affiliate_id_fkey: FOREIGN KEY on affiliate_id -> affiliates.id
  - location_pkey: PRIMARY KEY on location_id -> location.location_id
  - uq_location_external: UNIQUE on source_platform -> location.source_platform
  - uq_location_external: UNIQUE on source_location_id -> location.source_platform
  - uq_location_external: UNIQUE on source_platform -> location.source_location_id
  - uq_location_external: UNIQUE on source_location_id -> location.source_location_id

Indexes:
  - idx_location_affiliate: affiliate_id
  - location_pkey: location_id (UNIQUE) (PRIMARY)
  - uq_location_external: source_platform (UNIQUE)
  - uq_location_external: source_location_id (UNIQUE)


=== TABLE: mdh_config ===
Type: BASE TABLE
Row Count: 1

Columns:
  - id: integer NOT NULL
  - email: character varying(255) NULL
  - phone: character varying(50) NULL
  - sms_phone: character varying(50) NULL
  - logo_url: character varying(255) NULL
  - favicon_url: character varying(255) NULL
  - facebook: character varying(255) NULL
  - instagram: character varying(255) NULL
  - tiktok: character varying(255) NULL
  - youtube: character varying(255) NULL
  - header_display: character varying(255) NULL
  - location: character varying(255) NULL
  - name: character varying(255) NULL
  - tagline: text NULL
  - services_description: text NULL DEFAULT 'Auto, boat & RV detailing, paint correction, ceramic coating, and PPF'::text
  - created_at: timestamp with time zone NOT NULL DEFAULT now()
  - updated_at: timestamp with time zone NOT NULL DEFAULT now()

Constraints:
  - 2200_47298_16_not_null: CHECK
  - 2200_47298_17_not_null: CHECK
  - 2200_47298_1_not_null: CHECK
  - chk_singleton: CHECK -> mdh_config.id
  - mdh_config_pkey: PRIMARY KEY on id -> mdh_config.id

Indexes:
  - mdh_config_pkey: id (UNIQUE) (PRIMARY)

Sample Data (1 rows):
  Row 1: {"id":1,"email":"service@mobiledetailhub.com","phone":"(888) 555-1234","sms_phone":"+17024206066","logo_url":"/assets/logo.webp","favicon_url":"/assets/favicon.ico","facebook":"https://facebook.com/mobiledetailhub","instagram":"https://instagram.com/mobiledetailhub","tiktok":"https://tiktok.com/@mobiledetailhub","youtube":"https://youtube.com/mobiledetailhub","header_display":"Mobile Detail Hub","location":"Anywhere, USA","name":"Mobile Detail Hub","tagline":null,"services_description":"Auto, boat & RV detailing, paint correction, ceramic coating, and PPF","created_at":"2025-08-28T00:21:12.246Z","updated_at":"2025-08-28T00:21:12.246Z"}


=== TABLE: quotes ===
Type: BASE TABLE
Row Count: 0

Columns:
  - id: integer NOT NULL
  - affiliate_id: integer NOT NULL
  - customer_id: integer NULL
  - address_json: jsonb NOT NULL DEFAULT '{}'::jsonb
  - requested_start: timestamp with time zone NULL
  - status: USER-DEFINED NOT NULL DEFAULT 'new'::quote_status
  - details_json: jsonb NOT NULL DEFAULT '{}'::jsonb
  - estimated_total_cents: integer NULL
  - created_at: timestamp with time zone NOT NULL DEFAULT now()
  - updated_at: timestamp with time zone NOT NULL DEFAULT now()

Constraints:
  - 2200_47112_10_not_null: CHECK
  - 2200_47112_1_not_null: CHECK
  - 2200_47112_2_not_null: CHECK
  - 2200_47112_4_not_null: CHECK
  - 2200_47112_6_not_null: CHECK
  - 2200_47112_7_not_null: CHECK
  - 2200_47112_9_not_null: CHECK
  - quotes_affiliate_id_fkey: FOREIGN KEY on affiliate_id -> affiliates.id
  - quotes_customer_id_fkey: FOREIGN KEY on customer_id -> customers.id
  - quotes_estimated_total_cents_check: CHECK -> quotes.estimated_total_cents
  - quotes_pkey: PRIMARY KEY on id -> quotes.id

Indexes:
  - idx_quotes_affiliate_status: affiliate_id
  - idx_quotes_affiliate_status: status
  - idx_quotes_created_at: created_at
  - quotes_pkey: id (UNIQUE) (PRIMARY)


=== TABLE: refresh_tokens ===
Type: BASE TABLE
Row Count: 1

Columns:
  - id: integer NOT NULL
  - user_id: integer NOT NULL
  - token_hash: text NOT NULL
  - user_agent: text NULL
  - ip_address: inet NULL
  - device_id: text NULL
  - expires_at: timestamp with time zone NULL
  - revoked_at: timestamp with time zone NULL
  - is_revoked: boolean NULL
  - created_at: timestamp with time zone NOT NULL DEFAULT now()
  - updated_at: timestamp with time zone NOT NULL DEFAULT now()

Constraints:
  - 2200_47311_10_not_null: CHECK
  - 2200_47311_11_not_null: CHECK
  - 2200_47311_1_not_null: CHECK
  - 2200_47311_2_not_null: CHECK
  - 2200_47311_3_not_null: CHECK
  - refresh_tokens_pkey: PRIMARY KEY on id -> refresh_tokens.id
  - refresh_tokens_token_hash_key: UNIQUE on token_hash -> refresh_tokens.token_hash
  - refresh_tokens_user_id_fkey: FOREIGN KEY on user_id -> users.id

Indexes:
  - idx_refresh_tokens_active: user_id
  - idx_refresh_tokens_user_id: user_id
  - refresh_tokens_pkey: id (UNIQUE) (PRIMARY)
  - refresh_tokens_token_hash_key: token_hash (UNIQUE)

Sample Data (1 rows):
  Row 1: {"id":3,"user_id":1,"token_hash":"178f803514cc904a3dabdef1f2cdbb45c3ae4d1cf5c32c76f9d4a47ff096ed10","user_agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36","ip_address":"::1","device_id":"d0775dd38d37a7c8","expires_at":"2025-09-04T00:53:49.500Z","revoked_at":null,"is_revoked":false,"created_at":"2025-08-28T00:53:49.503Z","updated_at":"2025-08-28T00:53:49.503Z"}


=== TABLE: review_reply ===
Type: BASE TABLE
Row Count: 0

Columns:
  - id: bigint NOT NULL
  - review_id: bigint NOT NULL
  - text: text NULL
  - reply_update_time: timestamp with time zone NULL
  - created_at: timestamp with time zone NOT NULL DEFAULT now()
  - updated_at: timestamp with time zone NOT NULL DEFAULT now()

Constraints:
  - 2200_47265_1_not_null: CHECK
  - 2200_47265_2_not_null: CHECK
  - 2200_47265_5_not_null: CHECK
  - 2200_47265_6_not_null: CHECK
  - review_reply_pkey: PRIMARY KEY on id -> review_reply.id
  - review_reply_review_id_fkey: FOREIGN KEY on review_id -> reviews.id

Indexes:
  - review_reply_pkey: id (UNIQUE) (PRIMARY)


=== TABLE: review_sync_state ===
Type: BASE TABLE
Row Count: 0

Columns:
  - location_id: bigint NOT NULL
  - last_seen_update: timestamp with time zone NULL
  - created_at: timestamp with time zone NOT NULL DEFAULT now()
  - updated_at: timestamp with time zone NOT NULL DEFAULT now()

Constraints:
  - 2200_47280_1_not_null: CHECK
  - 2200_47280_3_not_null: CHECK
  - 2200_47280_4_not_null: CHECK
  - review_sync_state_location_id_fkey: FOREIGN KEY on location_id -> location.location_id
  - review_sync_state_pkey: PRIMARY KEY on location_id -> review_sync_state.location_id

Indexes:
  - review_sync_state_pkey: location_id (UNIQUE) (PRIMARY)


=== TABLE: reviews ===
Type: BASE TABLE
Row Count: 0

Columns:
  - id: bigint NOT NULL
  - external_id: text NULL
  - affiliate_id: integer NOT NULL
  - location_id: bigint NULL
  - rating: smallint NULL
  - text: text NULL
  - author_name: text NULL
  - author_profile_url: text NULL
  - create_time: timestamp with time zone NULL
  - update_time: timestamp with time zone NULL
  - is_deleted: boolean NOT NULL DEFAULT false
  - source_platform: USER-DEFINED NOT NULL
  - raw: jsonb NULL
  - created_at: timestamp with time zone NOT NULL DEFAULT now()
  - updated_at: timestamp with time zone NOT NULL DEFAULT now()

Constraints:
  - 2200_47240_11_not_null: CHECK
  - 2200_47240_12_not_null: CHECK
  - 2200_47240_14_not_null: CHECK
  - 2200_47240_15_not_null: CHECK
  - 2200_47240_1_not_null: CHECK
  - 2200_47240_3_not_null: CHECK
  - reviews_affiliate_id_fkey: FOREIGN KEY on affiliate_id -> affiliates.id
  - reviews_location_id_fkey: FOREIGN KEY on location_id -> location.location_id
  - reviews_pkey: PRIMARY KEY on id -> reviews.id
  - reviews_rating_check: CHECK -> reviews.rating
  - uq_reviews_ext: UNIQUE on external_id -> reviews.external_id
  - uq_reviews_ext: UNIQUE on source_platform -> reviews.external_id
  - uq_reviews_ext: UNIQUE on external_id -> reviews.source_platform
  - uq_reviews_ext: UNIQUE on source_platform -> reviews.source_platform

Indexes:
  - idx_reviews_active_time: affiliate_id
  - idx_reviews_active_time: create_time
  - idx_reviews_affiliate_time: affiliate_id
  - idx_reviews_affiliate_time: create_time
  - idx_reviews_location_time: location_id
  - idx_reviews_location_time: create_time
  - reviews_pkey: id (UNIQUE) (PRIMARY)
  - uq_reviews_ext: external_id (UNIQUE)
  - uq_reviews_ext: source_platform (UNIQUE)


=== TABLE: schema_migrations ===
Type: BASE TABLE
Row Count: 1

Columns:
  - version: text NOT NULL
  - applied_at: timestamp with time zone NULL DEFAULT now()
  - description: text NULL

Constraints:
  - 2200_47331_1_not_null: CHECK
  - schema_migrations_pkey: PRIMARY KEY on version -> schema_migrations.version

Indexes:
  - schema_migrations_pkey: version (UNIQUE) (PRIMARY)

Sample Data (1 rows):
  Row 1: {"version":"v3.1","applied_at":"2025-08-28T00:21:12.246Z","description":"Normalized schema + brand affiliate + tightened indexes"}


=== TABLE: service_area_slugs ===
Type: BASE TABLE
Row Count: 0

Columns:
  - id: integer NOT NULL
  - slug: character varying(255) NOT NULL
  - city_id: integer NOT NULL
  - zip: character varying(20) NULL
  - created_at: timestamp with time zone NULL DEFAULT now()
  - updated_at: timestamp with time zone NULL DEFAULT now()

Constraints:
  - 2200_47200_1_not_null: CHECK
  - 2200_47200_2_not_null: CHECK
  - 2200_47200_3_not_null: CHECK
  - service_area_slugs_city_id_fkey: FOREIGN KEY on city_id -> cities.id
  - service_area_slugs_pkey: PRIMARY KEY on id -> service_area_slugs.id
  - service_area_slugs_slug_check: CHECK -> service_area_slugs.slug
  - service_area_slugs_slug_key: UNIQUE on slug -> service_area_slugs.slug

Indexes:
  - idx_service_area_slugs_city: city_id
  - service_area_slugs_pkey: id (UNIQUE) (PRIMARY)
  - service_area_slugs_slug_key: slug (UNIQUE)


=== TABLE: service_tiers ===
Type: BASE TABLE
Row Count: 0

Columns:
  - id: integer NOT NULL
  - service_id: integer NOT NULL
  - name: character varying(100) NOT NULL
  - price_delta_cents: integer NOT NULL DEFAULT 0
  - description: text NULL
  - created_at: timestamp with time zone NOT NULL DEFAULT now()
  - updated_at: timestamp with time zone NOT NULL DEFAULT now()

Constraints:
  - 2200_47070_1_not_null: CHECK
  - 2200_47070_2_not_null: CHECK
  - 2200_47070_3_not_null: CHECK
  - 2200_47070_4_not_null: CHECK
  - 2200_47070_6_not_null: CHECK
  - 2200_47070_7_not_null: CHECK
  - service_tiers_pkey: PRIMARY KEY on id -> service_tiers.id
  - service_tiers_service_id_fkey: FOREIGN KEY on service_id -> services.id
  - uq_service_tiers_service_name: UNIQUE on service_id -> service_tiers.service_id
  - uq_service_tiers_service_name: UNIQUE on name -> service_tiers.service_id
  - uq_service_tiers_service_name: UNIQUE on service_id -> service_tiers.name
  - uq_service_tiers_service_name: UNIQUE on name -> service_tiers.name

Indexes:
  - idx_service_tiers_service_id: service_id
  - service_tiers_pkey: id (UNIQUE) (PRIMARY)
  - uq_service_tiers_service_name: service_id (UNIQUE)
  - uq_service_tiers_service_name: name (UNIQUE)


=== TABLE: services ===
Type: BASE TABLE
Row Count: 0

Columns:
  - id: integer NOT NULL
  - affiliate_id: integer NOT NULL
  - category: USER-DEFINED NOT NULL
  - name: character varying(200) NOT NULL
  - description: text NULL
  - base_price_cents: integer NOT NULL DEFAULT 0
  - pricing_unit: USER-DEFINED NOT NULL DEFAULT 'flat'::pricing_unit
  - min_duration_min: integer NOT NULL DEFAULT 60
  - active: boolean NOT NULL DEFAULT true
  - created_at: timestamp with time zone NOT NULL DEFAULT now()
  - updated_at: timestamp with time zone NOT NULL DEFAULT now()

Constraints:
  - 2200_47046_10_not_null: CHECK
  - 2200_47046_11_not_null: CHECK
  - 2200_47046_1_not_null: CHECK
  - 2200_47046_2_not_null: CHECK
  - 2200_47046_3_not_null: CHECK
  - 2200_47046_4_not_null: CHECK
  - 2200_47046_6_not_null: CHECK
  - 2200_47046_7_not_null: CHECK
  - 2200_47046_8_not_null: CHECK
  - 2200_47046_9_not_null: CHECK
  - services_affiliate_id_fkey: FOREIGN KEY on affiliate_id -> affiliates.id
  - services_base_price_cents_check: CHECK -> services.base_price_cents
  - services_min_duration_min_check: CHECK -> services.min_duration_min
  - services_pkey: PRIMARY KEY on id -> services.id
  - uq_services_affiliate_name: UNIQUE on affiliate_id -> services.name
  - uq_services_affiliate_name: UNIQUE on name -> services.name
  - uq_services_affiliate_name: UNIQUE on affiliate_id -> services.affiliate_id
  - uq_services_affiliate_name: UNIQUE on name -> services.affiliate_id

Indexes:
  - idx_services_affiliate_category: affiliate_id
  - idx_services_affiliate_category: category
  - services_pkey: id (UNIQUE) (PRIMARY)
  - uq_services_affiliate_name: affiliate_id (UNIQUE)
  - uq_services_affiliate_name: name (UNIQUE)


=== TABLE: states ===
Type: BASE TABLE
Row Count: 56

Columns:
  - state_code: character(2) NOT NULL
  - name: text NOT NULL
  - country_code: character(2) NOT NULL DEFAULT 'US'::bpchar

Constraints:
  - 2200_46911_1_not_null: CHECK
  - 2200_46911_2_not_null: CHECK
  - 2200_46911_3_not_null: CHECK
  - states_pkey: PRIMARY KEY on state_code -> states.state_code

Indexes:
  - states_pkey: state_code (UNIQUE) (PRIMARY)

Sample Data (3 rows):
  Row 1: {"state_code":"AL","name":"Alabama","country_code":"US"}
  Row 2: {"state_code":"AK","name":"Alaska","country_code":"US"}
  Row 3: {"state_code":"AZ","name":"Arizona","country_code":"US"}


=== TABLE: users ===
Type: BASE TABLE
Row Count: 1

Columns:
  - id: integer NOT NULL
  - email: USER-DEFINED NOT NULL
  - name: character varying(255) NULL
  - role: USER-DEFINED NOT NULL
  - is_admin: boolean NULL DEFAULT false
  - password_hash: character varying(255) NULL
  - phone: character varying(50) NULL
  - created_at: timestamp with time zone NOT NULL DEFAULT now()
  - updated_at: timestamp with time zone NOT NULL DEFAULT now()

Constraints:
  - 2200_46941_1_not_null: CHECK
  - 2200_46941_2_not_null: CHECK
  - 2200_46941_4_not_null: CHECK
  - 2200_46941_8_not_null: CHECK
  - 2200_46941_9_not_null: CHECK
  - users_email_key: UNIQUE on email -> users.email
  - users_phone_check: CHECK -> users.phone
  - users_pkey: PRIMARY KEY on id -> users.id

Indexes:
  - users_email_key: email (UNIQUE)
  - users_pkey: id (UNIQUE) (PRIMARY)

Sample Data (1 rows):
  Row 1: {"id":1,"email":"admin@mobiledetailhub.com","name":"Brandan Coleman","role":"admin","is_admin":true,"password_hash":"$2a$10$EAY3D9OdVXpYgby.ATOmheJwqrlTZ423Yg2a.qLzN1Ku1/oj2/LzS","phone":null,"created_at":"2025-08-28T00:21:12.246Z","updated_at":"2025-08-28T00:21:12.246Z"}


=== TABLE: v_affiliate_base_location ===
Type: VIEW
Row Count: 0

Columns:
  - affiliate_id: integer NULL
  - slug: character varying(100) NULL
  - business_name: character varying(255) NULL
  - city: text NULL
  - state_code: character(2) NULL
  - zip: character varying(20) NULL
  - city_name: text NULL
  - city_slug: text NULL
  - legacy_city: character varying(100) NULL

Sample Data (1 rows):
  Row 1: {"affiliate_id":1,"slug":"mdh","business_name":"Mobile Detail Hub","city":null,"state_code":null,"zip":null,"city_name":null,"city_slug":null,"legacy_city":null}


=== TABLE: v_served_cities ===
Type: VIEW
Row Count: 0

Columns:
  - state_code: character(2) NULL
  - city_name: text NULL
  - city_slug: text NULL
  - affiliates: bigint NULL


=== TABLE: v_served_states ===
Type: VIEW
Row Count: 0

Columns:
  - state_code: character(2) NULL
  - name: text NULL


