# Render.com Deployment Guide

## 🚀 **Full-Stack Deployment on Render**

This guide will help you deploy your entire application (frontend + backend + database) on Render.com.

## 📋 **Pre-Deployment Checklist**

### **1. Environment Variables**
Make sure you have these environment variables ready:

#### **Backend Environment Variables**
```bash
NODE_ENV=production
PORT=10000
DATABASE_URL=postgresql://... (will be auto-generated by Render)
JWT_SECRET=your-secret-key-here
JWT_REFRESH_SECRET=your-refresh-secret-here
ADMIN_EMAILS=admin@thatsmartsite.com
ALLOWED_ORIGINS=https://thatsmartsite.com,https://www.thatsmartsite.com
```

#### **Frontend Environment Variables**
```bash
VITE_API_BASE_URL=https://thatsmartsite-backend.onrender.com
VITE_APP_ENV=production
```

### **2. Database Migration**
The deployment will automatically run migrations, but ensure your migration files are ready.

## 🚀 **Deployment Steps**

### **Step 1: Connect Repository**
1. Go to [Render.com](https://render.com)
2. Connect your GitHub repository
3. Select the `thatsmartsite` repository

### **Step 2: Deploy Database**
1. Create a new **PostgreSQL** service
2. Name: `thatsmartsite-db`
3. Plan: **Starter** (free tier)
4. Database name: `thatsmartsite`
5. User: `thatsmartsite_user`

### **Step 3: Deploy Backend**
1. Create a new **Web Service**
2. Name: `thatsmartsite-backend`
3. Environment: **Node**
4. Plan: **Starter** (free tier)
5. Build Command: `cd backend && npm install && npm run migrate`
6. Start Command: `cd backend && npm start`
7. Health Check Path: `/api/health`

#### **Backend Environment Variables**
```bash
NODE_ENV=production
PORT=10000
DATABASE_URL=postgresql://thatsmartsite_user:password@host:5432/thatsmartsite
JWT_SECRET=your-secret-key-here
JWT_REFRESH_SECRET=your-refresh-secret-here
ADMIN_EMAILS=admin@thatsmartsite.com
ALLOWED_ORIGINS=https://thatsmartsite.com,https://www.thatsmartsite.com
```

### **Step 4: Deploy Frontend**
1. Create a new **Static Site**
2. Name: `thatsmartsite-frontend`
3. Build Command: `cd frontend && npm install && npm run build`
4. Publish Directory: `frontend/dist`

#### **Frontend Environment Variables**
```bash
VITE_API_BASE_URL=https://thatsmartsite-backend.onrender.com
VITE_APP_ENV=production
```

### **Step 5: Custom Domain**
1. Go to your frontend service settings
2. Add custom domain: `thatsmartsite.com`
3. Add www subdomain: `www.thatsmartsite.com`
4. Configure DNS records as instructed by Render

## 🔧 **Alternative: Single Service Deployment**

If you prefer a single service (simpler but less scalable):

### **Docker Deployment**
1. Create a new **Web Service**
2. Environment: **Docker**
3. Build Command: `docker build -t thatsmartsite .`
4. Start Command: `docker run -p 10000:10000 thatsmartsite`

This will use the `Dockerfile` we created, which builds both frontend and backend.

## 🛠️ **Post-Deployment Configuration**

### **1. Run Migrations**
```bash
# Connect to your backend service
# Run migrations manually if needed
npm run migrate
```

### **2. Test Health Endpoints**
```bash
# Backend health
curl https://thatsmartsite-backend.onrender.com/api/health

# Frontend (should serve the React app)
curl https://thatsmartsite.com
```

### **3. Verify Database Connection**
```bash
# Check database status
curl https://thatsmartsite-backend.onrender.com/api/health/db-status
```

## 🔍 **Monitoring & Debugging**

### **Health Checks**
- **Backend**: `https://thatsmartsite-backend.onrender.com/api/health`
- **Frontend**: `https://thatsmartsite.com` (should serve React app)

### **Logs**
- View logs in Render dashboard
- Backend logs show API requests and errors
- Frontend logs show build process

### **Common Issues**

#### **CORS Errors**
- Ensure `ALLOWED_ORIGINS` includes your domain
- Check that frontend is making requests to correct backend URL

#### **Database Connection Issues**
- Verify `DATABASE_URL` is correct
- Check that database service is running
- Ensure migrations have been applied

#### **Frontend Not Loading**
- Check that build completed successfully
- Verify static files are being served
- Check browser console for errors

## 🚀 **Production Optimizations**

### **1. Performance**
- Enable gzip compression in Render
- Use CDN for static assets
- Optimize images and bundle size

### **2. Security**
- Use strong JWT secrets
- Enable HTTPS (automatic on Render)
- Regular security updates

### **3. Monitoring**
- Set up uptime monitoring
- Configure error alerting
- Monitor database performance

## 📊 **Scaling Considerations**

### **When to Upgrade**
- **Starter Plan**: Good for development and small traffic
- **Standard Plan**: Better for production with moderate traffic
- **Pro Plan**: High-traffic production applications

### **Database Scaling**
- Start with shared database
- Upgrade to dedicated database for production
- Consider read replicas for high traffic

## 🎯 **Success Metrics**

After deployment, verify:
- ✅ Frontend loads at `thatsmartsite.com`
- ✅ Backend API responds at `/api/health`
- ✅ Database migrations applied successfully
- ✅ Admin dashboard accessible
- ✅ Tenant onboarding works
- ✅ Google Reviews integration functional

## 🆘 **Troubleshooting**

### **Build Failures**
- Check Node.js version compatibility
- Verify all dependencies are installed
- Check for TypeScript errors

### **Runtime Errors**
- Check environment variables
- Verify database connection
- Check CORS configuration

### **Performance Issues**
- Monitor resource usage in Render dashboard
- Check database query performance
- Optimize frontend bundle size

---

## 🎉 **You're Live!**

Once deployed, your application will be available at:
- **Frontend**: `https://thatsmartsite.com`
- **Backend API**: `https://thatsmartsite-backend.onrender.com`
- **Admin Dashboard**: `https://thatsmartsite.com/admin-dashboard`

**Next Steps:**
1. Test all functionality
2. Onboard your first tenant
3. Set up monitoring and alerts
4. Configure custom domain
5. Start marketing! 🚀
