{
  "name": "That Smart Site - Cursor Rules",
  "purpose": "Multi-tenant, white-label website generator for industry-specific local services (mobile detailing, maid service, lawn care, pet grooming, barber shops). Launch fast, conversion-focused sites per tenant with SEO/location pages, booking hooks, and review integrations â€” all from one shared codebase.",
  "description": "Feature-first architecture. Strong TS + linting discipline. Clear import boundaries. Clean UI with Tailwind + shadcn/ui.",
  "priorities": [
    "Clean, modular TypeScript (feature-first; components/ui only, side-effects in hooks, pure utils, isolated types)",
    "Multi-tenant config: per-tenant JSON, location pages, industry presets, theme tokens",
    "Reuse and composability across industries without copy-paste (shared primitives + industry adapters)",
    "Strict linting/formatting, testable units, and clear boundaries (no business logic in presentational components)",
    "SEO scaffolding: city/service pages, JSON-LD, meta helpers; GBP/reviews integration",
    "Performance + accessibility defaults (image pipelines, srcset, lazy/priority rules, a11y checks)",
    "Easy onboarding flows and preview links for prospects"
  ],
  "rules": [
    {
      "pattern": "**/*",
      "instructions": [
        "Architecture: feature-first. Each domain lives under frontend/src/features/<domain>/{components,hooks,api,state,types,pages,utils}.",
        "Boundaries: code inside one feature must NOT import from another feature directly. Only allowed paths are '@/features/<same-domain>/**' and '@/shared/**'. If a cross-feature need arises, extract to '@/shared/**'.",
        "Exports: prefer named exports. Only 'default export' allowed for top-level page components or small wrapper components.",
        "Types: keep Typescript strict. Avoid 'any', prefer zod schemas at boundaries. Co-locate types with the feature in 'types/'.",
        "State: use Zustand stores in 'state/'. Keep stores minimal; side-effects live in hooks.",
        "Hooks: data-fetching hooks use React Query under 'hooks/'. Query keys are namespaced by feature, e.g. ['affiliate','bySlug',slug].",
        "API layer: feature-local clients in 'api/'. No direct fetch in components. Centralize endpoints & DTO mapping here.",
        "UI: presentational components in 'components/'. Pure, no side-effects. Style with Tailwind; prefer shadcn/ui primitives.",
        "Utils: put pure helpers in 'utils/'. No IO, no DOM. Tested in isolation.",
        "Routing: pages go in 'pages/'. Pages compose feature components; avoid business logic in pages.",
        "Accessibility: follow jsx-a11y. Interactive elements use buttons/links properly. Labels on inputs.",
        "Testing: vitest + @testing-library/react. Tests live next to files or under __tests__ per feature.",
        "Filesize: split long components. If a file >200 lines or a component has >3 responsibilities, extract.",
        "Naming: components PascalCase, hooks start with use*, stores end with Store, types end with .types.ts, schema .schema.ts, API clients .api.ts.",
        "Imports: use path alias '@/'. Avoid relative traversals like '../../../'. Barrel files are allowed only inside a feature.",
        "CSS: Tailwind only; avoid ad-hoc inline styles except dynamic calculations.",
        "Lint: fix eslint warnings unless explicitly documented with a comment.",
        "Comments: add a top-of-file comment block when logic is non-trivial (why > what)."
      ]
    },
    {
      "pattern": "frontend/src/features/**/components/**/*.{ts,tsx}",
      "instructions": [
        "Components must be pure and stateless except for local UI state.",
        "No fetch, no direct API calls here; get data via props or feature hooks.",
        "Tailwind classes only; keep classNames short and readable. Extract reusable styles into small components."
      ]
    },
    {
      "pattern": "frontend/src/features/**/hooks/**/*.{ts,tsx}",
      "instructions": [
        "Encapsulate side-effects (fetching, subscriptions, timers).",
        "Use React Query for server cache; include robust error/loading states.",
        "All hooks must be testable; inject API clients when helpful."
      ]
    },
    {
      "pattern": "frontend/src/features/**/api/**/*.{ts,tsx}",
      "instructions": [
        "Single responsibility: HTTP calls + data mapping.",
        "Zod-validate external data at the boundary; return typed objects.",
        "No UI imports, no DOM usage."
      ]
    },
    {
      "pattern": "frontend/src/features/**/state/**/*.{ts,tsx}",
      "instructions": [
        "Use Zustand create() with explicit types.",
        "No async side-effects inside the store; put them in hooks that update store."
      ]
    },
    {
      "pattern": "frontend/src/shared/**/*",
      "instructions": [
        "Shared is the ONLY place cross-feature code may live.",
        "Keep shared utilities pure and generically useful. No feature-specific naming."
      ]
    },
    {
      "pattern": "frontend/src/**/*.{ts,tsx}",
      "instructions": [
        "TypeScript: no implicit any; no eslint-disable unless justified.",
        "Named exports by default; avoid default exports except for pages/components that are consumed by routers.",
        "Use absolute imports with '@/' alias."
      ]
    },
    {
      "pattern": "backend/migrations/**/*.sql",
      "instructions": [
        "Migration files must follow naming convention: YYYY-MM-DD_HHMM_description.sql",
        "Include both forward migration SQL and optional rollback SQL in comments.",
        "When a new migration is added, run `npm run migrate` to apply it locally.",
        "After applying, run `npm run db:snapshot` to regenerate docs/DATABASE.md.",
        "Never modify existing migration files once committed to version control.",
        "Always test migrations on staging environment before production.",
        "Include rollback instructions when possible using -- ROLLBACK: comment format."
      ]
    },
    {
      "pattern": "backend/scripts/migrate.js",
      "instructions": [
        "Migration script handles automatic detection and application of pending migrations.",
        "Tracks applied migrations in system.schema_migrations table with checksums.",
        "Provides safety checks to prevent double-application and content changes.",
        "Supports both 'migrate' and 'list' commands for status checking."
      ]
    },
    {
      "pattern": "backend/scripts/rollback.js",
      "instructions": [
        "Rollback script safely reverses the last applied migration.",
        "Requires explicit user confirmation before executing rollback.",
        "Uses rollback SQL stored in system.schema_migrations table.",
        "Provides 'list' command to show recent migrations and rollback availability."
      ]
    }
  ]
}
